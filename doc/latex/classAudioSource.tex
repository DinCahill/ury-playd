\hypertarget{classAudioSource}{\section{Audio\+Source Class Reference}
\label{classAudioSource}\index{Audio\+Source@{Audio\+Source}}
}


An object responsible for decoding an audio file.  




{\ttfamily \#include $<$audio\+\_\+source.\+hpp$>$}



Collaboration diagram for Audio\+Source\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=194pt]{classAudioSource__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159d}{Decode\+State} \+: std\+::uint8\+\_\+t \{ \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da22a62bc6e9b3fff5866c4259f046bad8}{Decode\+State\+::\+W\+A\+I\+T\+I\+N\+G\+\_\+\+F\+O\+R\+\_\+\+F\+R\+A\+M\+E}, 
\hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}{Decode\+State\+::\+D\+E\+C\+O\+D\+I\+N\+G}, 
\hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}{Decode\+State\+::\+E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E}
 \}
\begin{DoxyCompactList}\small\item\em An enumeration of possible states the decoder can be in. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_a836c61e348dbe7df6ba255669c015303}{using \hyperlink{classAudioSource_a836c61e348dbe7df6ba255669c015303}{Decode\+Vector} = std\+::vector$<$ std\+::uint8\+\_\+t $>$}\label{classAudioSource_a836c61e348dbe7df6ba255669c015303}

\begin{DoxyCompactList}\small\item\em Type of decoded sample vectors. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_aadbadeba50d982d09cfe0d1e05160ef9}{using \hyperlink{classAudioSource_aadbadeba50d982d09cfe0d1e05160ef9}{Decode\+Result} = std\+::pair$<$ \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159d}{Decode\+State}, \hyperlink{classAudioSource_a836c61e348dbe7df6ba255669c015303}{Decode\+Vector} $>$}\label{classAudioSource_aadbadeba50d982d09cfe0d1e05160ef9}

\begin{DoxyCompactList}\small\item\em Type of the result of \hyperlink{classAudioSource_a6b5071168332523b68593bc47170f36f}{Decode()}. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_a1c8138ec9ffb9fd1394d0ad0782d60fa}{using \hyperlink{classAudioSource_a1c8138ec9ffb9fd1394d0ad0782d60fa}{Sample\+Byte\+Count} = int}\label{classAudioSource_a1c8138ec9ffb9fd1394d0ad0782d60fa}

\begin{DoxyCompactList}\small\item\em Type for the count of bytes per sample. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classAudioSource_abcb925739a649c30663385a15d83af26}{Audio\+Source} (const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Constructs an \hyperlink{classAudioSource}{Audio\+Source}. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_a4d4b2be34ec676bf01d1ca1784f79a07}{\hyperlink{classAudioSource_a4d4b2be34ec676bf01d1ca1784f79a07}{$\sim$\+Audio\+Source} ()}\label{classAudioSource_a4d4b2be34ec676bf01d1ca1784f79a07}

\begin{DoxyCompactList}\small\item\em Destructs an \hyperlink{classAudioSource}{Audio\+Source}. \end{DoxyCompactList}\item 
std\+::string \hyperlink{classAudioSource_aea5c3828f1b22a9e103a5d56f9ffa5ec}{Path} () const 
\begin{DoxyCompactList}\small\item\em Gets the file-\/path of this audio source's audio file. \end{DoxyCompactList}\item 
\hyperlink{classAudioSource_aadbadeba50d982d09cfe0d1e05160ef9}{Decode\+Result} \hyperlink{classAudioSource_a6b5071168332523b68593bc47170f36f}{Decode} ()
\begin{DoxyCompactList}\small\item\em Performs a round of decoding. \end{DoxyCompactList}\item 
std\+::uint8\+\_\+t \hyperlink{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}{Channel\+Count} () const 
\begin{DoxyCompactList}\small\item\em Returns the channel count. \end{DoxyCompactList}\item 
double \hyperlink{classAudioSource_aee0c4889919554f3c947a217f4436378}{Sample\+Rate} () const 
\begin{DoxyCompactList}\small\item\em Returns the sample rate. \end{DoxyCompactList}\item 
\hyperlink{sample__formats_8hpp_a21cca244e782ff3acc8805fb73236772}{Sample\+Format} \hyperlink{classAudioSource_aa6c567c4e2f3c6673d2a289d84aedae0}{Output\+Sample\+Format} () const 
\begin{DoxyCompactList}\small\item\em Returns the output sample format. \end{DoxyCompactList}\item 
size\+\_\+t \hyperlink{classAudioSource_af63c7249c1cf8d4ef86274ea2fdc1f26}{Buffer\+Sample\+Capacity} () const 
\begin{DoxyCompactList}\small\item\em Returns the number of samples this decoder's buffer can store. \end{DoxyCompactList}\item 
size\+\_\+t \hyperlink{classAudioSource_ae6eb4d0fc3d1d60375edc2745b635818}{Bytes\+Per\+Sample} () const 
\begin{DoxyCompactList}\small\item\em Returns the number of bytes for each sample this decoder outputs. \end{DoxyCompactList}\item 
std\+::uint64\+\_\+t \hyperlink{classAudioSource_ad8639603fb59d21f5c1369707f16975c}{Seek} (std\+::chrono\+::microseconds position)
\begin{DoxyCompactList}\small\item\em Seeks to the given position, in microseconds. \end{DoxyCompactList}\item 
std\+::uint64\+\_\+t \hyperlink{classAudioSource_ac0a5d14505c36238d4a8a465122ff06e}{Sample\+Position\+From\+Microseconds} (std\+::chrono\+::microseconds position) const 
\begin{DoxyCompactList}\small\item\em Converts a position in microseconds to an elapsed sample count. \end{DoxyCompactList}\item 
std\+::chrono\+::microseconds \hyperlink{classAudioSource_aa9c0d4b60adfc1470a560bbb8e66aaf8}{Microsecond\+Position\+From\+Samples} (std\+::uint64\+\_\+t samples) const 
\begin{DoxyCompactList}\small\item\em Converts an elapsed sample count to a position in microseconds. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classAudioSource_a9b10234d7c9f29b17008b4dc3eab2a71}{Open} (const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Opens a new file for this \hyperlink{classAudioSource}{Audio\+Source}. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_a46444de950d02ac35a695ad167fed2f4}{void \hyperlink{classAudioSource_a46444de950d02ac35a695ad167fed2f4}{Close} ()}\label{classAudioSource_a46444de950d02ac35a695ad167fed2f4}

\begin{DoxyCompactList}\small\item\em Closes the \hyperlink{classAudioSource}{Audio\+Source}'s current file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159d}{Decode\+State} \hyperlink{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{decode\+\_\+state}
\begin{DoxyCompactList}\small\item\em The current state of decoding. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}{std\+::vector$<$ uint8\+\_\+t $>$ \hyperlink{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}{buffer}}\label{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}

\begin{DoxyCompactList}\small\item\em The decoding buffer. \end{DoxyCompactList}\item 
\hypertarget{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{sox\+\_\+format\+\_\+t $\ast$ \hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}}\label{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}

\begin{DoxyCompactList}\small\item\em Pointer to the So\+X context associated with this source. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classAudioSource_a9c269c8d9c633bcd11d596c1ba3fd575}{static const size\+\_\+t \hyperlink{classAudioSource_a9c269c8d9c633bcd11d596c1ba3fd575}{B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E} = 16384}\label{classAudioSource_a9c269c8d9c633bcd11d596c1ba3fd575}

\begin{DoxyCompactList}\small\item\em The size of the internal decoding buffer, in bytes. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
An object responsible for decoding an audio file. 

The \hyperlink{classAudioSource}{Audio\+Source} is an interface to the ffmpeg library, which represents all the ffmpeg state associated with one file. It can be polled to decode frames of audio data, which are returned as byte vectors. 

Definition at line \hyperlink{audio__source_8hpp_source_l00032}{32} of file \hyperlink{audio__source_8hpp_source}{audio\+\_\+source.\+hpp}.



\subsection{Member Enumeration Documentation}
\hypertarget{classAudioSource_a9a2f5de44325c84e69a7af1331aa159d}{\index{Audio\+Source@{Audio\+Source}!Decode\+State@{Decode\+State}}
\index{Decode\+State@{Decode\+State}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Decode\+State}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf Audio\+Source\+::\+Decode\+State} \+: std\+::uint8\+\_\+t\hspace{0.3cm}{\ttfamily [strong]}}}\label{classAudioSource_a9a2f5de44325c84e69a7af1331aa159d}


An enumeration of possible states the decoder can be in. 

\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{W\+A\+I\+T\+I\+N\+G\+\_\+\+F\+O\+R\+\_\+\+F\+R\+A\+M\+E@{W\+A\+I\+T\+I\+N\+G\+\_\+\+F\+O\+R\+\_\+\+F\+R\+A\+M\+E}!Audio\+Source@{Audio\+Source}}\index{Audio\+Source@{Audio\+Source}!W\+A\+I\+T\+I\+N\+G\+\_\+\+F\+O\+R\+\_\+\+F\+R\+A\+M\+E@{W\+A\+I\+T\+I\+N\+G\+\_\+\+F\+O\+R\+\_\+\+F\+R\+A\+M\+E}}\item[{\em 
\hypertarget{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da22a62bc6e9b3fff5866c4259f046bad8}{W\+A\+I\+T\+I\+N\+G\+\_\+\+F\+O\+R\+\_\+\+F\+R\+A\+M\+E}\label{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da22a62bc6e9b3fff5866c4259f046bad8}
}]The decoder is currently trying to acquire a frame. \index{D\+E\+C\+O\+D\+I\+N\+G@{D\+E\+C\+O\+D\+I\+N\+G}!Audio\+Source@{Audio\+Source}}\index{Audio\+Source@{Audio\+Source}!D\+E\+C\+O\+D\+I\+N\+G@{D\+E\+C\+O\+D\+I\+N\+G}}\item[{\em 
\hypertarget{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}{D\+E\+C\+O\+D\+I\+N\+G}\label{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}
}]The decoder is currently decoding a frame. \index{E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E@{E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E}!Audio\+Source@{Audio\+Source}}\index{Audio\+Source@{Audio\+Source}!E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E@{E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E}}\item[{\em 
\hypertarget{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}{E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E}\label{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}
}]The decoder has run out of things to decode. \end{description}
\end{Desc}


Definition at line \hyperlink{audio__source_8hpp_source_l00035}{35} of file \hyperlink{audio__source_8hpp_source}{audio\+\_\+source.\+hpp}.


\begin{DoxyCode}
00035                            : std::uint8\_t \{
00037         WAITING\_FOR\_FRAME,
00039         DECODING,
00041         END\_OF\_FILE
00042     \};
\end{DoxyCode}


\subsection{Constructor \& Destructor Documentation}
\hypertarget{classAudioSource_abcb925739a649c30663385a15d83af26}{\index{Audio\+Source@{Audio\+Source}!Audio\+Source@{Audio\+Source}}
\index{Audio\+Source@{Audio\+Source}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Audio\+Source}]{\setlength{\rightskip}{0pt plus 5cm}Audio\+Source\+::\+Audio\+Source (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{path}
\end{DoxyParamCaption}
)}}\label{classAudioSource_abcb925739a649c30663385a15d83af26}


Constructs an \hyperlink{classAudioSource}{Audio\+Source}. 


\begin{DoxyParams}{Parameters}
{\em path} & The path to the file to load and decode using this decoder. \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{audio__source_8cpp_source_l00034}{34} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8cpp_source_l00172}{Open()}.


\begin{DoxyCode}
00035     : \hyperlink{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}{buffer}(\hyperlink{classAudioSource_a9c269c8d9c633bcd11d596c1ba3fd575}{BUFFER\_SIZE}), \hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}(\textcolor{keyword}{nullptr})
00036 \{
00037     \hyperlink{classAudioSource_a9b10234d7c9f29b17008b4dc3eab2a71}{Open}(path);
00038 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classAudioSource_af63c7249c1cf8d4ef86274ea2fdc1f26}{\index{Audio\+Source@{Audio\+Source}!Buffer\+Sample\+Capacity@{Buffer\+Sample\+Capacity}}
\index{Buffer\+Sample\+Capacity@{Buffer\+Sample\+Capacity}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Buffer\+Sample\+Capacity}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t Audio\+Source\+::\+Buffer\+Sample\+Capacity (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_af63c7249c1cf8d4ef86274ea2fdc1f26}


Returns the number of samples this decoder's buffer can store. 

\begin{DoxyReturn}{Returns}
The buffer sample capacity, in samples. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00058}{58} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8hpp_source_l00142}{buffer}, and \hyperlink{audio__source_8cpp_source_l00091}{Bytes\+Per\+Sample()}.



Referenced by \hyperlink{audio__source_8cpp_source_l00133}{Decode()}.


\begin{DoxyCode}
00059 \{
00060     \textcolor{keywordflow}{return} this->\hyperlink{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}{buffer}.size() / this->\hyperlink{classAudioSource_ae6eb4d0fc3d1d60375edc2745b635818}{BytesPerSample}();
00061 \}
\end{DoxyCode}
\hypertarget{classAudioSource_ae6eb4d0fc3d1d60375edc2745b635818}{\index{Audio\+Source@{Audio\+Source}!Bytes\+Per\+Sample@{Bytes\+Per\+Sample}}
\index{Bytes\+Per\+Sample@{Bytes\+Per\+Sample}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Bytes\+Per\+Sample}]{\setlength{\rightskip}{0pt plus 5cm}size\+\_\+t Audio\+Source\+::\+Bytes\+Per\+Sample (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_ae6eb4d0fc3d1d60375edc2745b635818}


Returns the number of bytes for each sample this decoder outputs. 

As the decoder returns packed samples, this includes the channel count as a factor. \begin{DoxyReturn}{Returns}
The number of bytes per sample. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00091}{91} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8cpp_source_l00052}{Channel\+Count()}, and \hyperlink{audio__source_8hpp_source_l00145}{context}.



Referenced by \hyperlink{audio__source_8cpp_source_l00058}{Buffer\+Sample\+Capacity()}, and \hyperlink{audio__source_8cpp_source_l00133}{Decode()}.


\begin{DoxyCode}
00092 \{
00093     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} != \textcolor{keyword}{nullptr});
00094 
00095     \textcolor{comment}{// Since libsox always outputs 32-bit samples, the bytes per sample is}
00096     \textcolor{comment}{// always 4 per channel.}
00097 
00098     \textcolor{comment}{// SoX has a slightly peculiar notion of sample counts, in that it}
00099     \textcolor{comment}{// regards each channel as having its own separate sample, so we need}
00100     \textcolor{comment}{// to multiply and divide sample counts by the channel count when}
00101     \textcolor{comment}{// talking to SoX.}
00102     \textcolor{keywordflow}{return} 4 * \hyperlink{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}{ChannelCount}();
00103 \}
\end{DoxyCode}
\hypertarget{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}{\index{Audio\+Source@{Audio\+Source}!Channel\+Count@{Channel\+Count}}
\index{Channel\+Count@{Channel\+Count}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Channel\+Count}]{\setlength{\rightskip}{0pt plus 5cm}std\+::uint8\+\_\+t Audio\+Source\+::\+Channel\+Count (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}


Returns the channel count. 

\begin{DoxyReturn}{Returns}
The number of channels this \hyperlink{classAudioSource}{Audio\+Source} is decoding. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00052}{52} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8hpp_source_l00145}{context}.



Referenced by \hyperlink{audio__source_8cpp_source_l00091}{Bytes\+Per\+Sample()}, \hyperlink{audio__source_8cpp_source_l00133}{Decode()}, and \hyperlink{audio__source_8cpp_source_l00105}{Seek()}.


\begin{DoxyCode}
00053 \{
00054     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} != \textcolor{keyword}{nullptr});
00055     \textcolor{keywordflow}{return} this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}->signal.channels;
00056 \}
\end{DoxyCode}
\hypertarget{classAudioSource_a6b5071168332523b68593bc47170f36f}{\index{Audio\+Source@{Audio\+Source}!Decode@{Decode}}
\index{Decode@{Decode}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Decode}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Audio\+Source\+::\+Decode\+Result} Audio\+Source\+::\+Decode (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classAudioSource_a6b5071168332523b68593bc47170f36f}


Performs a round of decoding. 

\begin{DoxyReturn}{Returns}
A pair of the decoder's state upon finishing the decoding round and the vector of bytes decoded. The vector may be empty, if the decoding round did not finish off a frame. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00133}{133} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8hpp_source_l00142}{buffer}, \hyperlink{audio__source_8cpp_source_l00058}{Buffer\+Sample\+Capacity()}, \hyperlink{audio__source_8cpp_source_l00091}{Bytes\+Per\+Sample()}, \hyperlink{audio__source_8cpp_source_l00052}{Channel\+Count()}, \hyperlink{audio__source_8hpp_source_l00145}{context}, \hyperlink{audio__source_8hpp_source_l00140}{decode\+\_\+state}, \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}{D\+E\+C\+O\+D\+I\+N\+G}, and \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}{E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E}.


\begin{DoxyCode}
00134 \{
00135     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} != \textcolor{keyword}{nullptr});
00136 
00137     \textcolor{keyword}{auto} buf = \textcolor{keyword}{reinterpret\_cast<}sox\_sample\_t *\textcolor{keyword}{>}(&this->\hyperlink{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}{buffer}.front());
00138 
00139     \textcolor{comment}{// See BytesPerSample() for an explanation of this ChannelCount().}
00140     \textcolor{keyword}{auto} sox\_capacity = \hyperlink{classAudioSource_af63c7249c1cf8d4ef86274ea2fdc1f26}{BufferSampleCapacity}() * 
      \hyperlink{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}{ChannelCount}();
00141     \textcolor{keywordtype}{size\_t} read = sox\_read(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}, buf, sox\_capacity);
00142 
00143     \hyperlink{classAudioSource_a836c61e348dbe7df6ba255669c015303}{DecodeVector} decoded;
00144 
00145     \textcolor{keywordflow}{if} (read == 0) \{
00146         this->\hyperlink{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{decode\_state} = \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}{DecodeState::END\_OF\_FILE};
00147     \} \textcolor{keywordflow}{else} \{
00148         this->\hyperlink{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{decode\_state} = \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}{DecodeState::DECODING};
00149 
00150         \textcolor{comment}{// Copy only the bit of the buffer occupied by decoded data}
00151         \textcolor{comment}{// See BytesPerSample() for an explanation of the}
00152         \textcolor{comment}{// ChannelCount() division.}
00153         \textcolor{keyword}{auto} front = this->\hyperlink{classAudioSource_ad278f3b315e3ad91add683d5eda48a03}{buffer}.begin();
00154         \textcolor{keyword}{auto} read\_bytes = (\hyperlink{classAudioSource_ae6eb4d0fc3d1d60375edc2745b635818}{BytesPerSample}() * read) / \hyperlink{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}{ChannelCount}();
00155         decoded = \hyperlink{classAudioSource_a836c61e348dbe7df6ba255669c015303}{DecodeVector}(front, front + read\_bytes);
00156     \}
00157 
00158     \textcolor{keywordflow}{return} std::make\_pair(this->\hyperlink{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{decode\_state}, decoded);
00159 \}
\end{DoxyCode}
\hypertarget{classAudioSource_aa9c0d4b60adfc1470a560bbb8e66aaf8}{\index{Audio\+Source@{Audio\+Source}!Microsecond\+Position\+From\+Samples@{Microsecond\+Position\+From\+Samples}}
\index{Microsecond\+Position\+From\+Samples@{Microsecond\+Position\+From\+Samples}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Microsecond\+Position\+From\+Samples}]{\setlength{\rightskip}{0pt plus 5cm}std\+::chrono\+::microseconds Audio\+Source\+::\+Microsecond\+Position\+From\+Samples (
\begin{DoxyParamCaption}
\item[{std\+::uint64\+\_\+t}]{samples}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_aa9c0d4b60adfc1470a560bbb8e66aaf8}


Converts an elapsed sample count to a position in microseconds. 


\begin{DoxyParams}{Parameters}
{\em samples} & The number of elapsed samples. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The corresponding song position, in microseconds. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00081}{81} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8cpp_source_l00063}{Sample\+Rate()}.


\begin{DoxyCode}
00083 \{
00084     \textcolor{comment}{// This is basically SamplePositionFromMicroseconds but backwards.}
00085 
00086     \textcolor{keyword}{auto} position\_secs = std::chrono::seconds(samples) / \hyperlink{classAudioSource_aee0c4889919554f3c947a217f4436378}{SampleRate}();
00087     \textcolor{keywordflow}{return} std::chrono::duration\_cast<std::chrono::microseconds>(
00088                     position\_secs);
00089 \}
\end{DoxyCode}
\hypertarget{classAudioSource_a9b10234d7c9f29b17008b4dc3eab2a71}{\index{Audio\+Source@{Audio\+Source}!Open@{Open}}
\index{Open@{Open}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Open}]{\setlength{\rightskip}{0pt plus 5cm}void Audio\+Source\+::\+Open (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{path}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{classAudioSource_a9b10234d7c9f29b17008b4dc3eab2a71}


Opens a new file for this \hyperlink{classAudioSource}{Audio\+Source}. 


\begin{DoxyParams}{Parameters}
{\em path} & The absolute path to the audio file to load. \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{audio__source_8cpp_source_l00172}{172} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8cpp_source_l00184}{Close()}, and \hyperlink{audio__source_8hpp_source_l00145}{context}.



Referenced by \hyperlink{audio__source_8cpp_source_l00034}{Audio\+Source()}, and \hyperlink{audio__source_8cpp_source_l00105}{Seek()}.


\begin{DoxyCode}
00173 \{
00174     \hyperlink{classAudioSource_a46444de950d02ac35a695ad167fed2f4}{Close}();
00175 
00176     this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} = sox\_open\_read(path.c\_str(), \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr});
00177     \textcolor{keywordflow}{if} (this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} == \textcolor{keyword}{nullptr}) \{
00178         std::ostringstream os;
00179         os << \textcolor{stringliteral}{"couldn't open "} << path;
00180         \textcolor{keywordflow}{throw} \hyperlink{classFileError}{FileError}(os.str());
00181     \}
00182 \}
\end{DoxyCode}
\hypertarget{classAudioSource_aa6c567c4e2f3c6673d2a289d84aedae0}{\index{Audio\+Source@{Audio\+Source}!Output\+Sample\+Format@{Output\+Sample\+Format}}
\index{Output\+Sample\+Format@{Output\+Sample\+Format}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Output\+Sample\+Format}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Sample\+Format} Audio\+Source\+::\+Output\+Sample\+Format (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_aa6c567c4e2f3c6673d2a289d84aedae0}


Returns the output sample format. 

\begin{DoxyReturn}{Returns}
The output sample format, as a Sample\+Format.

The sample format of the data returned by this decoder. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00164}{164} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{sample__formats_8hpp_a21cca244e782ff3acc8805fb73236772ae222eded89afdf8cf763bb1a58a04fc0}{P\+A\+C\+K\+E\+D\+\_\+\+S\+I\+G\+N\+E\+D\+\_\+\+I\+N\+T\+\_\+32}.


\begin{DoxyCode}
00165 \{
00166     \textcolor{comment}{// 'The function sox\_read reads len samples in to buf using the format}
00167     \textcolor{comment}{// handler specified by ft. All data read is converted to 32-bit signed}
00168     \textcolor{comment}{// samples before being placed in to buf.'}
00169     \textcolor{keywordflow}{return} \hyperlink{sample__formats_8hpp_a21cca244e782ff3acc8805fb73236772ae222eded89afdf8cf763bb1a58a04fc0}{SampleFormat::PACKED\_SIGNED\_INT\_32};
00170 \}
\end{DoxyCode}
\hypertarget{classAudioSource_aea5c3828f1b22a9e103a5d56f9ffa5ec}{\index{Audio\+Source@{Audio\+Source}!Path@{Path}}
\index{Path@{Path}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Path}]{\setlength{\rightskip}{0pt plus 5cm}std\+::string Audio\+Source\+::\+Path (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_aea5c3828f1b22a9e103a5d56f9ffa5ec}


Gets the file-\/path of this audio source's audio file. 

\begin{DoxyReturn}{Returns}
The audio file's path. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00045}{45} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8hpp_source_l00145}{context}.



Referenced by \hyperlink{audio__source_8cpp_source_l00105}{Seek()}.


\begin{DoxyCode}
00046 \{
00047     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} != \textcolor{keyword}{nullptr});
00048     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}->filename != \textcolor{keyword}{nullptr});
00049     \textcolor{keywordflow}{return} std::string(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}->filename);
00050 \}
\end{DoxyCode}
\hypertarget{classAudioSource_ac0a5d14505c36238d4a8a465122ff06e}{\index{Audio\+Source@{Audio\+Source}!Sample\+Position\+From\+Microseconds@{Sample\+Position\+From\+Microseconds}}
\index{Sample\+Position\+From\+Microseconds@{Sample\+Position\+From\+Microseconds}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Sample\+Position\+From\+Microseconds}]{\setlength{\rightskip}{0pt plus 5cm}std\+::uint64\+\_\+t Audio\+Source\+::\+Sample\+Position\+From\+Microseconds (
\begin{DoxyParamCaption}
\item[{std\+::chrono\+::microseconds}]{position}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_ac0a5d14505c36238d4a8a465122ff06e}


Converts a position in microseconds to an elapsed sample count. 


\begin{DoxyParams}{Parameters}
{\em position} & The song position, in microseconds. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The corresponding number of elapsed samples. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00069}{69} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8cpp_source_l00063}{Sample\+Rate()}.



Referenced by \hyperlink{audio__source_8cpp_source_l00105}{Seek()}.


\begin{DoxyCode}
00071 \{
00072     \textcolor{comment}{// The sample rate is expressed in terms of samples per second, so we}
00073     \textcolor{comment}{// need to convert the position to seconds then multiply by the rate.}
00074     \textcolor{comment}{// We do things in a slightly peculiar order to minimise rounding.}
00075 
00076     \textcolor{keyword}{auto} sample\_micros = usec * \hyperlink{classAudioSource_aee0c4889919554f3c947a217f4436378}{SampleRate}();
00077     \textcolor{keywordflow}{return} std::chrono::duration\_cast<std::chrono::seconds>(sample\_micros)
00078                     .count();
00079 \}
\end{DoxyCode}
\hypertarget{classAudioSource_aee0c4889919554f3c947a217f4436378}{\index{Audio\+Source@{Audio\+Source}!Sample\+Rate@{Sample\+Rate}}
\index{Sample\+Rate@{Sample\+Rate}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Sample\+Rate}]{\setlength{\rightskip}{0pt plus 5cm}double Audio\+Source\+::\+Sample\+Rate (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classAudioSource_aee0c4889919554f3c947a217f4436378}


Returns the sample rate. 

\begin{DoxyReturn}{Returns}
The output sample rate (Hz) as a double-\/precision floating point. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00063}{63} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8hpp_source_l00145}{context}.



Referenced by \hyperlink{audio__source_8cpp_source_l00081}{Microsecond\+Position\+From\+Samples()}, and \hyperlink{audio__source_8cpp_source_l00069}{Sample\+Position\+From\+Microseconds()}.


\begin{DoxyCode}
00064 \{
00065     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} != \textcolor{keyword}{nullptr});
00066     \textcolor{keywordflow}{return} this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}->signal.rate;
00067 \}
\end{DoxyCode}
\hypertarget{classAudioSource_ad8639603fb59d21f5c1369707f16975c}{\index{Audio\+Source@{Audio\+Source}!Seek@{Seek}}
\index{Seek@{Seek}!Audio\+Source@{Audio\+Source}}
\subsubsection[{Seek}]{\setlength{\rightskip}{0pt plus 5cm}std\+::uint64\+\_\+t Audio\+Source\+::\+Seek (
\begin{DoxyParamCaption}
\item[{std\+::chrono\+::microseconds}]{position}
\end{DoxyParamCaption}
)}}\label{classAudioSource_ad8639603fb59d21f5c1369707f16975c}


Seeks to the given position, in microseconds. 

For convenience, the new position (in terms of samples) is returned. 
\begin{DoxyParams}{Parameters}
{\em position} & The new position in the file, in microseconds. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The new position in the file, in samples. 
\end{DoxyReturn}


Definition at line \hyperlink{audio__source_8cpp_source_l00105}{105} of file \hyperlink{audio__source_8cpp_source}{audio\+\_\+source.\+cpp}.



References \hyperlink{audio__source_8cpp_source_l00052}{Channel\+Count()}, \hyperlink{audio__source_8cpp_source_l00184}{Close()}, \hyperlink{audio__source_8hpp_source_l00145}{context}, \hyperlink{audio__source_8hpp_source_l00140}{decode\+\_\+state}, \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}{D\+E\+C\+O\+D\+I\+N\+G}, \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}{E\+N\+D\+\_\+\+O\+F\+\_\+\+F\+I\+L\+E}, \hyperlink{messages_8h_source_l00033}{M\+S\+G\+\_\+\+S\+E\+E\+K\+\_\+\+F\+A\+I\+L}, \hyperlink{audio__source_8cpp_source_l00172}{Open()}, \hyperlink{audio__source_8cpp_source_l00045}{Path()}, and \hyperlink{audio__source_8cpp_source_l00069}{Sample\+Position\+From\+Microseconds()}.


\begin{DoxyCode}
00106 \{
00107     assert(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context} != \textcolor{keyword}{nullptr});
00108 
00109     \textcolor{keyword}{auto} samples = \hyperlink{classAudioSource_ac0a5d14505c36238d4a8a465122ff06e}{SamplePositionFromMicroseconds}(position);
00110 
00111     \textcolor{comment}{// See BytesPerSample() for an explanation of this ChannelCount().}
00112     \textcolor{keyword}{auto} sox\_samples = samples * \hyperlink{classAudioSource_a267178b39a3a4d2fc86f41f6a96caf03}{ChannelCount}();
00113 
00114     \textcolor{comment}{// libsox doesn't seem to like seeking into an ended file, so close}
00115     \textcolor{comment}{// and re-open it first.}
00116     \textcolor{keywordflow}{if} (this->\hyperlink{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{decode\_state} == \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da581953f6b20ad7f993b64b1dc632032e}{DecodeState::END\_OF\_FILE}) \{
00117         std::string path = \hyperlink{classAudioSource_aea5c3828f1b22a9e103a5d56f9ffa5ec}{Path}();
00118         \hyperlink{classAudioSource_a46444de950d02ac35a695ad167fed2f4}{Close}();
00119         \hyperlink{classAudioSource_a9b10234d7c9f29b17008b4dc3eab2a71}{Open}(path);
00120     \}
00121 
00122     \textcolor{keywordflow}{if} (sox\_seek(this->\hyperlink{classAudioSource_a2bbce89d4bef9cf46b1113de3245655a}{context}, sox\_samples, SOX\_SEEK\_SET) != SOX\_SUCCESS) \{
00123         \textcolor{keywordflow}{throw} \hyperlink{classInternalError}{InternalError}(\hyperlink{messages_8h_aed3c894dfba47c4007dc39b38b5d3dbe}{MSG\_SEEK\_FAIL});
00124     \}
00125 
00126     \textcolor{comment}{// Reset the decoder state, because otherwise the decoder will get very}
00127     \textcolor{comment}{// confused.}
00128     this->\hyperlink{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{decode\_state} = \hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159da9b75f3acd3c3480965b0f5ee466e7f25}{DecodeState::DECODING};
00129 
00130     \textcolor{keywordflow}{return} samples;
00131 \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}{\index{Audio\+Source@{Audio\+Source}!decode\+\_\+state@{decode\+\_\+state}}
\index{decode\+\_\+state@{decode\+\_\+state}!Audio\+Source@{Audio\+Source}}
\subsubsection[{decode\+\_\+state}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Decode\+State} Audio\+Source\+::decode\+\_\+state\hspace{0.3cm}{\ttfamily [private]}}}\label{classAudioSource_abe3899ebe685335a84c5bfee5a20a96f}


The current state of decoding. 

\begin{DoxySeeAlso}{See also}
\hyperlink{classAudioSource_a9a2f5de44325c84e69a7af1331aa159d}{Decode\+State} 
\end{DoxySeeAlso}


Definition at line \hyperlink{audio__source_8hpp_source_l00140}{140} of file \hyperlink{audio__source_8hpp_source}{audio\+\_\+source.\+hpp}.



Referenced by \hyperlink{audio__source_8cpp_source_l00133}{Decode()}, and \hyperlink{audio__source_8cpp_source_l00105}{Seek()}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/audio/\hyperlink{audio__source_8hpp}{audio\+\_\+source.\+hpp}\item 
src/audio/\hyperlink{audio__source_8cpp}{audio\+\_\+source.\+cpp}\end{DoxyCompactItemize}
