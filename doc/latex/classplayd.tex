\hypertarget{classplayd}{\section{playd Class Reference}
\label{classplayd}\index{playd@{playd}}
}


The playd application.  




{\ttfamily \#include $<$main.\+hpp$>$}



Collaboration diagram for playd\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classplayd__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classplayd_a2dfa519ee11ce75fbe389fcf3b15e122}{playd} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Constructs a playd, initialising its libraries. \end{DoxyCompactList}\item 
int \hyperlink{classplayd_aee84626965c812db03120ebe3267fcab}{Run} ()
\begin{DoxyCompactList}\small\item\em Runs playd. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{classplayd_a767d029a5d1321e912c1a2a92e8f3c64}{Get\+Device\+I\+D} ()
\begin{DoxyCompactList}\small\item\em Tries to get the output device I\+D from program arguments. \end{DoxyCompactList}\item 
void \hyperlink{classplayd_a9b32921db2f987d1faa28cbac50a0ed3}{List\+Output\+Devices} ()
\begin{DoxyCompactList}\small\item\em Lists on stdout all sound devices to which the audio output may connect. \end{DoxyCompactList}\item 
void \hyperlink{classplayd_a9fa7e8f2ccbd46c10bd604bb510d6304}{Register\+Commands} (\hyperlink{classPlayer}{Player} $\ast$p)
\begin{DoxyCompactList}\small\item\em Registers the playd command set on the given \hyperlink{classPlayer}{Player}. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classplayd_a58d45d86bd51dea16f476aae648ff63c}{std\+::vector$<$ std\+::string $>$ \hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}}\label{classplayd_a58d45d86bd51dea16f476aae648ff63c}

\begin{DoxyCompactList}\small\item\em The argument vector. \end{DoxyCompactList}\item 
\hypertarget{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{\hyperlink{classAudioSystem}{Audio\+System} \hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}}\label{classplayd_a2c7193680bd18f1e9b3f63f2234485de}

\begin{DoxyCompactList}\small\item\em The audio subsystem. \end{DoxyCompactList}\item 
\hypertarget{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{\hyperlink{classPlayer}{Player} \hyperlink{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{player}}\label{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}

\begin{DoxyCompactList}\small\item\em The player subsystem. \end{DoxyCompactList}\item 
\hypertarget{classplayd_a738bb18c13d3fd7db82ce000dd43d604}{\hyperlink{classCommandHandler}{Command\+Handler} \hyperlink{classplayd_a738bb18c13d3fd7db82ce000dd43d604}{handler}}\label{classplayd_a738bb18c13d3fd7db82ce000dd43d604}

\begin{DoxyCompactList}\small\item\em The command handler. \end{DoxyCompactList}\item 
\hypertarget{classplayd_af9e02b98b1eadecaab2941481dfb803b}{\hyperlink{classPlayer_ab2c65f4a7cbaf6aab6fafbb5633a42c4}{Player\+::\+T\+P} \hyperlink{classplayd_af9e02b98b1eadecaab2941481dfb803b}{time\+\_\+parser}}\label{classplayd_af9e02b98b1eadecaab2941481dfb803b}

\begin{DoxyCompactList}\small\item\em The seek time parser. \end{DoxyCompactList}\item 
\hypertarget{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{std\+::unique\+\_\+ptr$<$ \hyperlink{classIoReactor}{Io\+Reactor} $>$ \hyperlink{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{io}}\label{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}

\begin{DoxyCompactList}\small\item\em The I/\+O handler. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classplayd_a540bcb2dac9488bcb8e593378005bd07}{static const \\*
std\+::chrono\+::microseconds \hyperlink{classplayd_a540bcb2dac9488bcb8e593378005bd07}{P\+O\+S\+I\+T\+I\+O\+N\+\_\+\+P\+E\+R\+I\+O\+D}}\label{classplayd_a540bcb2dac9488bcb8e593378005bd07}

\begin{DoxyCompactList}\small\item\em The period between position announcements from the \hyperlink{classPlayer}{Player} object. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The playd application. 

This class contains all the state required by playd, with the exception of that introduced by external C libraries. It is a R\+A\+I\+I class, so constructing playd will load playd's library dependencies, and destructing it will unload them. It is probably not safe to create more than one playd. 

Definition at line \hyperlink{main_8hpp_source_l00029}{29} of file \hyperlink{main_8hpp_source}{main.\+hpp}.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classplayd_a2dfa519ee11ce75fbe389fcf3b15e122}{\index{playd@{playd}!playd@{playd}}
\index{playd@{playd}!playd@{playd}}
\subsubsection[{playd}]{\setlength{\rightskip}{0pt plus 5cm}playd\+::playd (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{classplayd_a2dfa519ee11ce75fbe389fcf3b15e122}


Constructs a playd, initialising its libraries. 


\begin{DoxyParams}{Parameters}
{\em argc} & The argument count from the main function. \\
\hline
{\em argv} & The argument vector from the main function. \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{main_8cpp_source_l00115}{115} of file \hyperlink{main_8cpp_source}{main.\+cpp}.



References \hyperlink{main_8hpp_source_l00048}{arguments}, \hyperlink{main_8hpp_source_l00051}{handler}, \hyperlink{main_8hpp_source_l00053}{io}, and \hyperlink{main_8hpp_source_l00050}{player}.


\begin{DoxyCode}
00116     : \hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}(), \hyperlink{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{player}(\hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}, \hyperlink{classplayd_af9e02b98b1eadecaab2941481dfb803b}{time\_parser}), \hyperlink{classplayd_a738bb18c13d3fd7db82ce000dd43d604}{handler}(
      \hyperlink{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{player}), \hyperlink{classplayd_af9e02b98b1eadecaab2941481dfb803b}{time\_parser}(\hyperlink{main_8cpp_a889c521ce751c2db7ba216a612c1d784}{UNITS})
00117 \{
00118     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < argc; i++) \{
00119         this->\hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}.push\_back(std::string(argv[i]));
00120     \}
00121 
00122     \textcolor{keyword}{auto} size = this->\hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}.size();
00123 
00124     std::string addr = size > 2 ? this->\hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}.at(2) : \textcolor{stringliteral}{"0.0.0.0"};
00125     std::string port = size > 3 ? this->\hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}.at(3) : \textcolor{stringliteral}{"1350"};
00126     this->\hyperlink{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{io} = decltype(this->\hyperlink{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{io})(
00127                     \textcolor{keyword}{new} \hyperlink{classIoReactor}{IoReactor}(this->\hyperlink{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{player}, this->\hyperlink{classplayd_a738bb18c13d3fd7db82ce000dd43d604}{handler}, addr, port));
00128 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classplayd_a767d029a5d1321e912c1a2a92e8f3c64}{\index{playd@{playd}!Get\+Device\+I\+D@{Get\+Device\+I\+D}}
\index{Get\+Device\+I\+D@{Get\+Device\+I\+D}!playd@{playd}}
\subsubsection[{Get\+Device\+I\+D}]{\setlength{\rightskip}{0pt plus 5cm}int playd\+::\+Get\+Device\+I\+D (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{classplayd_a767d029a5d1321e912c1a2a92e8f3c64}


Tries to get the output device I\+D from program arguments. 

\begin{DoxyReturn}{Returns}
The device I\+D, -\/1 if invalid selection (or none). 
\end{DoxyReturn}


Definition at line \hyperlink{main_8cpp_source_l00040}{40} of file \hyperlink{main_8cpp_source}{main.\+cpp}.



References \hyperlink{main_8hpp_source_l00048}{arguments}, \hyperlink{main_8hpp_source_l00049}{audio}, \hyperlink{audio__system_8cpp_source_l00055}{Audio\+System\+::\+Get\+Devices\+Info()}, and \hyperlink{audio__system_8cpp_source_l00069}{Audio\+System\+::\+Is\+Output\+Device()}.



Referenced by \hyperlink{main_8cpp_source_l00130}{Run()}.


\begin{DoxyCode}
00041 \{
00042     \textcolor{keywordflow}{if} (this->\hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}.size() < 2) \textcolor{keywordflow}{return} -1;
00043 
00044     \textcolor{comment}{/* Only accept valid numbers. */}
00045     \textcolor{keywordtype}{int} id;
00046     \textcolor{keywordflow}{try}
00047     \{
00048         \textcolor{keywordtype}{id} = std::stoi(this->\hyperlink{classplayd_a58d45d86bd51dea16f476aae648ff63c}{arguments}[1]);
00049     \}
00050     \textcolor{keywordflow}{catch} (...)
00051     \{
00052         \textcolor{comment}{/* Only std::invalid\_argument and std::out\_of\_range are thrown}
00053 \textcolor{comment}{         * here. */}
00054         \textcolor{keywordflow}{return} -1;
00055     \}
00056 
00057     \textcolor{comment}{/* Only allow valid (output) devices. */}
00058     \textcolor{keyword}{auto} device\_list = this->\hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}.\hyperlink{classAudioSystem_aa268faeb9243c18588631024958856e6}{GetDevicesInfo}();
00059     \textcolor{keywordflow}{if} (this->\hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}.\hyperlink{classAudioSystem_a001cd82f854883b80b3ed7d35795581b}{IsOutputDevice}(\textcolor{keywordtype}{id})) \{
00060         \textcolor{keywordflow}{return} id;
00061     \}
00062 
00063     \textcolor{keywordflow}{return} -1;
00064 \}
\end{DoxyCode}
\hypertarget{classplayd_a9b32921db2f987d1faa28cbac50a0ed3}{\index{playd@{playd}!List\+Output\+Devices@{List\+Output\+Devices}}
\index{List\+Output\+Devices@{List\+Output\+Devices}!playd@{playd}}
\subsubsection[{List\+Output\+Devices}]{\setlength{\rightskip}{0pt plus 5cm}void playd\+::\+List\+Output\+Devices (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{classplayd_a9b32921db2f987d1faa28cbac50a0ed3}


Lists on stdout all sound devices to which the audio output may connect. 

This is mainly for the benefit of the end user. \hypertarget{classplayd_a9fa7e8f2ccbd46c10bd604bb510d6304}{\index{playd@{playd}!Register\+Commands@{Register\+Commands}}
\index{Register\+Commands@{Register\+Commands}!playd@{playd}}
\subsubsection[{Register\+Commands}]{\setlength{\rightskip}{0pt plus 5cm}void playd\+::\+Register\+Commands (
\begin{DoxyParamCaption}
\item[{{\bf Player} $\ast$}]{p}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{classplayd_a9fa7e8f2ccbd46c10bd604bb510d6304}


Registers the playd command set on the given \hyperlink{classPlayer}{Player}. 


\begin{DoxyParams}{Parameters}
{\em p} & The \hyperlink{classPlayer}{Player} on which the commands will act. \\
\hline
\end{DoxyParams}
\hypertarget{classplayd_aee84626965c812db03120ebe3267fcab}{\index{playd@{playd}!Run@{Run}}
\index{Run@{Run}!playd@{playd}}
\subsubsection[{Run}]{\setlength{\rightskip}{0pt plus 5cm}int playd\+::\+Run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classplayd_aee84626965c812db03120ebe3267fcab}


Runs playd. 

\begin{DoxyReturn}{Returns}
The exit code, which may be returned by the program. 
\end{DoxyReturn}


Definition at line \hyperlink{main_8cpp_source_l00130}{130} of file \hyperlink{main_8cpp_source}{main.\+cpp}.



References \hyperlink{main_8hpp_source_l00049}{audio}, \hyperlink{main_8cpp_source_l00040}{Get\+Device\+I\+D()}, \hyperlink{audio__system_8cpp_source_l00055}{Audio\+System\+::\+Get\+Devices\+Info()}, \hyperlink{main_8hpp_source_l00053}{io}, \hyperlink{main_8hpp_source_l00050}{player}, \hyperlink{main_8hpp_source_l00046}{P\+O\+S\+I\+T\+I\+O\+N\+\_\+\+P\+E\+R\+I\+O\+D}, \hyperlink{audio__system_8cpp_source_l00078}{Audio\+System\+::\+Set\+Device\+I\+D()}, \hyperlink{player__position_8cpp_source_l00021}{Player\+::\+Set\+Position\+Response\+Period()}, and \hyperlink{player_8cpp_source_l00067}{Player\+::\+Set\+Response\+Sink()}.



Referenced by \hyperlink{main_8cpp_source_l00028}{main()}.


\begin{DoxyCode}
00131 \{
00132     \textcolor{keywordflow}{try}
00133     \{
00134         \textcolor{comment}{// Don't roll this into the constructor: it'll go out of scope!}
00135         \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = this->\hyperlink{classplayd_a767d029a5d1321e912c1a2a92e8f3c64}{GetDeviceID}();
00136         \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id} == -1) \{
00137             \textcolor{comment}{/* Oops, user entered an invalid sound device. */}
00138             \textcolor{keyword}{auto} device\_list = this->\hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}.\hyperlink{classAudioSystem_aa268faeb9243c18588631024958856e6}{GetDevicesInfo}();
00139             \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} &device : device\_list) \{
00140                 std::cout << device.first << \textcolor{stringliteral}{": "}
00141                           << device.second << std::endl;
00142             \}
00143             \textcolor{keywordflow}{return} EXIT\_FAILURE;
00144         \}
00145         this->\hyperlink{classplayd_a2c7193680bd18f1e9b3f63f2234485de}{audio}.\hyperlink{classAudioSystem_ade3b400828991d02e36a0b61302d30d2}{SetDeviceID}(\textcolor{keywordtype}{id});
00146 
00147         this->\hyperlink{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{player}.\hyperlink{classPlayer_a1e65e04dae199230d80639112ac07288}{SetPositionResponsePeriod}(
      \hyperlink{classplayd_a540bcb2dac9488bcb8e593378005bd07}{POSITION\_PERIOD});
00148         this->\hyperlink{classplayd_a8712fc23f3139a2fd2e9dbfb24b998dd}{player}.\hyperlink{classPlayer_a719de5af4d1534c2d805a19d5d995deb}{SetResponseSink}(*this->\hyperlink{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{io});
00149         this->\hyperlink{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{io}->Run();
00150     \}
00151     \textcolor{keywordflow}{catch} (\hyperlink{classError}{Error} &error)
00152     \{
00153         \hyperlink{classplayd_a066cb450455e1359e4f80cfa5ecb5c05}{io}->RespondWithError(error);
00154         \hyperlink{classDebug}{Debug}() << \textcolor{stringliteral}{"Unhandled exception caught, going away now."}
00155                 << std::endl;
00156         \textcolor{keywordflow}{return} EXIT\_FAILURE;
00157     \}
00158 
00159     \textcolor{keywordflow}{return} EXIT\_SUCCESS;
00160 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/\hyperlink{main_8hpp}{main.\+hpp}\item 
src/\hyperlink{main_8cpp}{main.\+cpp}\end{DoxyCompactItemize}
