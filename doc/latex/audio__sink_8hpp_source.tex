\hypertarget{audio__sink_8hpp_source}{\section{audio\+\_\+sink.\+hpp}
\label{audio__sink_8hpp_source}\index{src/audio/audio\+\_\+sink.\+hpp@{src/audio/audio\+\_\+sink.\+hpp}}
}

\begin{DoxyCode}
00001 \textcolor{comment}{// This file is part of playd.}
00002 \textcolor{comment}{// playd is licenced under the MIT license: see LICENSE.txt.}
00003 
00010 \textcolor{preprocessor}{#ifndef PS\_AUDIO\_SINK\_HPP}
00011 \textcolor{preprocessor}{#define PS\_AUDIO\_SINK\_HPP}
00012 
00013 \textcolor{preprocessor}{#include <chrono>}
00014 \textcolor{preprocessor}{#include <cstdint>}
00015 \textcolor{preprocessor}{#include <memory>}
00016 \textcolor{preprocessor}{#include <string>}
00017 \textcolor{preprocessor}{#include <utility>}
00018 \textcolor{preprocessor}{#include <vector>}
00019 
00020 \textcolor{preprocessor}{#include "portaudio.h"}
00021 \textcolor{preprocessor}{#include "portaudiocpp/CallbackInterface.hxx"}
00022 \textcolor{preprocessor}{#include "portaudiocpp/Stream.hxx"}
00023 
00024 \textcolor{preprocessor}{#include "\hyperlink{audio__source_8hpp}{audio\_source.hpp}"}
00025 \textcolor{preprocessor}{#include "\hyperlink{ringbuffer_8hpp}{ringbuffer.hpp}"}
00026 
\hypertarget{audio__sink_8hpp_source_l00028}{}\hyperlink{audio__sink_8hpp_af1e317131d6c3a3f0adf7c5fca059d74}{00028} \textcolor{keyword}{using} \hyperlink{audio__sink_8hpp_af1e317131d6c3a3f0adf7c5fca059d74}{PlayCallbackStepResult} = std::pair<PaStreamCallbackResult, unsigned long>;
00029 
\hypertarget{audio__sink_8hpp_source_l00038}{}\hyperlink{classAudioSink}{00038} \textcolor{keyword}{class }\hyperlink{classAudioSink}{AudioSink} : portaudio::CallbackInterface \{
00039 \textcolor{keyword}{public}:
00042     \textcolor{keyword}{using} \hyperlink{classAudioSink_ae5b8370aa17c24c6fc8f8e0c5778168c}{StreamConfigurator} = std::function<
\hypertarget{audio__sink_8hpp_source_l00043}{}\hyperlink{classAudioSink_ae5b8370aa17c24c6fc8f8e0c5778168c}{00043}                     portaudio::Stream *(portaudio::CallbackInterface &)>;
00044 
00046     \textcolor{keyword}{using} \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} =
\hypertarget{audio__sink_8hpp_source_l00047}{}\hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{00047}                     std::pair<PaStreamCallbackResult, unsigned long>;
00048 
\hypertarget{audio__sink_8hpp_source_l00050}{}\hyperlink{classAudioSink_ad2d7d33b3e937d057a4d72afad812737}{00050}     \textcolor{keyword}{using} \hyperlink{classAudioSink_ad2d7d33b3e937d057a4d72afad812737}{SamplePosition} = std::uint64\_t;
00051 
\hypertarget{audio__sink_8hpp_source_l00053}{}\hyperlink{classAudioSink_a60c1743d66e02b77f04791e72fa4cd0b}{00053}     \textcolor{keyword}{using} \hyperlink{classAudioSink_a60c1743d66e02b77f04791e72fa4cd0b}{TransferIterator} = AudioSource::DecodeVector::iterator;
00054 
00061     \hyperlink{classAudioSink_ab4adf46e3e93d35e2b5fb1ab0e75793b}{AudioSink}(\textcolor{keyword}{const} \hyperlink{classAudioSink_ae5b8370aa17c24c6fc8f8e0c5778168c}{StreamConfigurator} c,
00062               \hyperlink{classAudioSource_a1c8138ec9ffb9fd1394d0ad0782d60fa}{AudioSource::SampleByteCount} 
      \hyperlink{classAudioSink_a5eab0f7111187c0416feb542010e4a2e}{bytes\_per\_sample});
00063 
00069     \textcolor{keywordtype}{void} \hyperlink{classAudioSink_a18196e0dec3b4d58e17c454379ed0728}{Start}();
00070 
00076     \textcolor{keywordtype}{void} \hyperlink{classAudioSink_af1937ad09b555f0b88d285e8fd7cf433}{Stop}();
00077 
00084     \textcolor{keywordtype}{bool} \hyperlink{classAudioSink_adfa8006db0d1cbe161f15232cb32a324}{IsStopped}();
00085 
00093     \hyperlink{classAudioSink_ad2d7d33b3e937d057a4d72afad812737}{SamplePosition} \hyperlink{classAudioSink_aed168a8ce8ba39105431ab54ab08a007}{Position}();
00094 
00102     \textcolor{keywordtype}{void} \hyperlink{classAudioSink_a5ca539e3440d168eec0892114a947529}{SetPosition}(\hyperlink{classAudioSink_ad2d7d33b3e937d057a4d72afad812737}{SamplePosition} samples);
00103 
00109     \textcolor{keywordtype}{bool} \hyperlink{classAudioSink_a9b3dbe861acd4bb7ac1903730a0a01f3}{InputReady}();
00110 
00116     \textcolor{keywordtype}{void} \hyperlink{classAudioSink_aaa92237f7ab548c1a898981f4dcd631c}{SetInputReady}(\textcolor{keywordtype}{bool} ready);
00117 
00132     \textcolor{keywordtype}{void} \hyperlink{classAudioSink_a455e211f4f16eaa21e7b75412cc8a8ae}{Transfer}(\hyperlink{classAudioSink_a60c1743d66e02b77f04791e72fa4cd0b}{TransferIterator} &start, \textcolor{keyword}{const} 
      \hyperlink{classAudioSink_a60c1743d66e02b77f04791e72fa4cd0b}{TransferIterator} &end);
00133 
00134 \textcolor{keyword}{private}:
\hypertarget{audio__sink_8hpp_source_l00137}{}\hyperlink{classAudioSink_a152e5a388d4570211509a2a19a38c321}{00137}     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} \hyperlink{classAudioSink_a152e5a388d4570211509a2a19a38c321}{RINGBUF\_POWER};
00138 
\hypertarget{audio__sink_8hpp_source_l00140}{}\hyperlink{classAudioSink_a5eab0f7111187c0416feb542010e4a2e}{00140}     \hyperlink{classAudioSource_a1c8138ec9ffb9fd1394d0ad0782d60fa}{AudioSource::SampleByteCount} \hyperlink{classAudioSink_a5eab0f7111187c0416feb542010e4a2e}{bytes\_per\_sample};
00141 
\hypertarget{audio__sink_8hpp_source_l00143}{}\hyperlink{classAudioSink_a87184f85d6cfcc7310043b877caeaee2}{00143}     \hyperlink{classRingBuffer}{RingBuffer<char, unsigned long>} \hyperlink{classAudioSink_a87184f85d6cfcc7310043b877caeaee2}{ring\_buf};
00144 
\hypertarget{audio__sink_8hpp_source_l00146}{}\hyperlink{classAudioSink_aac90e7d95e98ac08b7c661a301eff1b2}{00146}     std::unique\_ptr<portaudio::Stream> \hyperlink{classAudioSink_aac90e7d95e98ac08b7c661a301eff1b2}{stream};
00147 
\hypertarget{audio__sink_8hpp_source_l00149}{}\hyperlink{classAudioSink_ac3403a492b8aba8d483961d1ec09fa26}{00149}     std::uint64\_t \hyperlink{classAudioSink_ac3403a492b8aba8d483961d1ec09fa26}{position\_sample\_count};
00150 
\hypertarget{audio__sink_8hpp_source_l00153}{}\hyperlink{classAudioSink_a00cbaaf2b4fcf5d9acb614b909234196}{00153}     \textcolor{keywordtype}{bool} \hyperlink{classAudioSink_a00cbaaf2b4fcf5d9acb614b909234196}{just\_started};
00154 
\hypertarget{audio__sink_8hpp_source_l00156}{}\hyperlink{classAudioSink_ad644a3477077e87f76cd24c9cb268f30}{00156}     \textcolor{keywordtype}{bool} \hyperlink{classAudioSink_ad644a3477077e87f76cd24c9cb268f30}{input\_ready};
00157 
00171     \textcolor{keywordtype}{int} \hyperlink{classAudioSink_ad3534ea4210aa83b42706c0361fd3e8d}{paCallbackFun}(\textcolor{keyword}{const} \textcolor{keywordtype}{void} *inputBuffer, \textcolor{keywordtype}{void} *outputBuffer,
00172                       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} numFrames,
00173                       \textcolor{keyword}{const} PaStreamCallbackTimeInfo *timeInfo,
00174                       PaStreamCallbackFlags statusFlags) \textcolor{keyword}{override};
00175 
00185     \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} \hyperlink{classAudioSink_a450ad1c0c64ddcc9b9a40d325983cbd9}{PlayCallbackStep}(\textcolor{keywordtype}{char} *out,
00186                                             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} frames\_per\_buf,
00187                                             \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} in);
00188 
00201     \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} \hyperlink{classAudioSink_a2194fd0629b52c550c9eb326f8ae10cc}{PlayCallbackSuccess}(\textcolor{keywordtype}{char} *out,
00202                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} avail,
00203                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} frames\_per\_buf,
00204                                                \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} in);
00205 
00218     \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} \hyperlink{classAudioSink_a6e1b9254b242231ba8168e5e27d602ff}{PlayCallbackFailure}(\textcolor{keywordtype}{char} *out,
00219                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} avail,
00220                                                \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} frames\_per\_buf,
00221                                                \hyperlink{classAudioSink_a73002cc57611ac384c4e9d419e706e50}{PlayCallbackStepResult} in);
00222 
00232     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \hyperlink{classAudioSink_a00ed918435d6f65b9533869453d5ae56}{ReadSamplesToOutput}(\textcolor{keywordtype}{char} *&output,
00233                                       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} output\_capacity,
00234                                       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} buffered\_count);
00235 \};
00236 
00237 \textcolor{preprocessor}{#endif // PS\_AUDIO\_SINK\_HPP}
\end{DoxyCode}
